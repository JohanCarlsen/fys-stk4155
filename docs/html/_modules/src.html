<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>src &mdash; FYS-STK4155  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            FYS-STK4155
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../project1.html">Project 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project2.html">Project 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project2.html#artificial-neural-network-class">Artificial neural network class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project2.html#artificial-neural-network-methods">Artificial neural network methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project2.html#regression-analysis-class">Regression analysis class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project2.html#regression-analysis-methods">Regression analysis methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project2.html#logistic-regression-methods">Logistic regression methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project2.html#preprocessing-of-data">Preprocessing of data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project2.html#cost-functions">Cost functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project2.html#activation-functions">Activation functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project3.html">Project 3</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">FYS-STK4155</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">src</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for src</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span> 
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;props&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span><span class="p">,</span> <span class="n">gridspec</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">LinearLocator</span><span class="p">,</span> <span class="n">FormatStrFormatter</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">KFold</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span> <span class="k">as</span> <span class="n">MSE</span><span class="p">,</span> <span class="n">r2_score</span> <span class="k">as</span> <span class="n">R2</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">Lasso</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">resample</span> 
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">svd</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">perf_counter_ns</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">calc</span> <span class="kn">import</span> <span class="n">Calculate</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s1">&#39;lines.linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;xtick.direction&#39;</span><span class="p">:</span> <span class="s1">&#39;inout&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ytick.direction&#39;</span><span class="p">:</span> <span class="s1">&#39;inout&#39;</span><span class="p">,</span>
    <span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s1">&#39;axes.titlesize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s1">&#39;axes.labelsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s1">&#39;xtick.major.width&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
    <span class="s1">&#39;ytick.major.width&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
    <span class="s1">&#39;xtick.minor.width&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
    <span class="s1">&#39;ytick.minor.width&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
    <span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s1">&#39;legend.fontsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s1">&#39;legend.fancybox&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;legend.frameon&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;savefig.bbox&#39;</span><span class="p">:</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span>
    <span class="s1">&#39;axes.formatter.use_mathtext&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;axes.formatter.useoffset&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;axes.formatter.limits&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="p">})</span>

<div class="viewcode-block" id="set_size">
<a class="viewcode-back" href="../project1.html#src.set_size">[docs]</a>
<span class="k">def</span> <span class="nf">set_size</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">subplot</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Set the size of a figure where the height/wifdth equals the golden ratio.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    width : {&#39;col&#39;, &#39;text&#39;} or float, optional </span>
<span class="sd">        Width of the figure in pt. Possible values:</span>

<span class="sd">            * &#39;col&#39; (default): 255.46837</span>
<span class="sd">            * &#39;text&#39; : 528.93675</span>

<span class="sd">    scale : float, default: 1.0</span>
<span class="sd">        How to scale the height of the figure, ie. ``figsize=(width, height * scale)``</span>

<span class="sd">    subplot : tuple, default: (1, 1)</span>
<span class="sd">        How to scale the figure size based on the number of subplots:</span>
<span class="sd">        ``figsize=(width, height * subplot[0] / subplot[1])``</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        Dimension of the figure, ie. ``(width, height * scale * subplot[0] / subplot[1])``</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">        The built-in values for `width` and `height` are the column width and text width</span>
<span class="sd">        in REVTeX document class. To obtain the appropriate values for your document, </span>
<span class="sd">        run the commands ``\the\columnwidth`` and ``\the\textwidth`` in your document body.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">widths</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;col&#39;</span><span class="p">:</span> <span class="mf">255.46837</span><span class="p">,</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="mf">528.93675</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">width</span> <span class="ow">in</span> <span class="n">widths</span><span class="p">:</span>
        <span class="n">width_pt</span> <span class="o">=</span> <span class="n">widths</span><span class="p">[</span><span class="n">width</span><span class="p">]</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">width_pt</span> <span class="o">=</span> <span class="n">width</span>
    
    <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">fig_width</span> <span class="o">=</span> <span class="n">width_pt</span> <span class="o">/</span> <span class="mf">72.27</span>
    <span class="n">fig_height</span> <span class="o">=</span> <span class="n">fig_width</span> <span class="o">*</span> <span class="n">ratio</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">subplot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">subplot</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">fig_dims</span> <span class="o">=</span> <span class="p">(</span><span class="n">fig_width</span><span class="p">,</span> <span class="n">fig_height</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig_dims</span></div>


<div class="viewcode-block" id="Regression">
<a class="viewcode-back" href="../project1.html#src.Regression">[docs]</a>
<span class="k">class</span> <span class="nc">Regression</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Regression class for Ordinary Least Square (:any:`OLS`), Ridge,</span>
<span class="sd">    and Lasso (:any:`ridge_and_lasso`) regression. </span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    x_data, y_data : array_like</span>
<span class="sd">        Data along the x and y axes.</span>

<span class="sd">    z_data : array_like, default: None</span>
<span class="sd">        If the function describing the data is 2D, the z_data parameter describe</span>
<span class="sd">        the data along the z axis.</span>
<span class="sd">    </span>
<span class="sd">    name : str, optional</span>
<span class="sd">        The name that will be the title of certain figures. If not set during</span>
<span class="sd">        initialization, the figname has to be set  when calling :any:`plot_evolution`</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">z_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># Setting the Calculate class as a property of Regression</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span> <span class="o">=</span> <span class="n">Calculate</span><span class="p">()</span>

        <span class="c1"># Likely to be removed as data is 2D</span>
        <span class="k">if</span> <span class="n">z_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">x_data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_data</span> <span class="o">=</span> <span class="n">y_data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">tot_data_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_data</span> <span class="o">=</span> <span class="n">z_data</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">tot_data_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_data</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Loaded with </span><span class="si">{</span><span class="n">tot_data_points</span><span class="si">}</span><span class="s1"> data points.&#39;</span><span class="p">)</span>

        <span class="c1"># Split the data into train and test, and scale by subtracting</span>
        <span class="c1"># the mean and divide by the standard deviation.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train_unscaled</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_test_unscaled</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_data</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
        <span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_train_unscaled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_train_unscaled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_test_unscaled</span><span class="p">)</span>

<div class="viewcode-block" id="Regression.OLS">
<a class="viewcode-back" href="../project1.html#src.Regression.OLS">[docs]</a>
    <span class="k">def</span> <span class="nf">OLS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_poly</span><span class="p">,</span> <span class="n">identity_test</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">store_beta</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Ordinary least square regression method.</span>

<span class="sd">        .. math::</span>
<span class="sd">            \begin{align}</span>
<span class="sd">            \tilde\beta &amp;= (X^TX)^{-1}X^Ty \\</span>
<span class="sd">            \tilde y &amp;= X\tilde\beta</span>
<span class="sd">            \end{align}</span>
<span class="sd">        </span>
<span class="sd">        with a user-defined polynomial degree.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_poly : int</span>
<span class="sd">            Polynomial degree.</span>

<span class="sd">        identity_test : bool, default: False</span>
<span class="sd">            If ``True``, the method performs a test to see if the implementation is correct, </span>
<span class="sd">            ie. if the design matrix is the identity matrix, the mean square error should be 0.</span>
<span class="sd">        </span>
<span class="sd">        store_beta : bool, default: True</span>
<span class="sd">            If the input data is large, there is a chance that the beta values will be large </span>
<span class="sd">            arrays. This parameter ensures the betas are not stored.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        opt_deg : int</span>
<span class="sd">            The degree where the MSE of the test data is lowest.</span>
<span class="sd">        </span>
<span class="sd">        beta_opt : ndarray</span>
<span class="sd">            The optimal parameters for the lowest MSE.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">max_polys</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">n_poly</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_poly</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store_beta</span> <span class="o">=</span> <span class="n">store_beta</span>

        <span class="c1"># Should return 0.</span>
        <span class="k">if</span> <span class="n">identity_test</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">))</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X</span><span class="p">)</span> <span class="o">@</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_data</span>
            <span class="n">y_tilde</span> <span class="o">=</span> <span class="n">X</span> <span class="o">@</span> <span class="n">beta</span> 
            <span class="n">mse</span> <span class="o">=</span> <span class="n">MSE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_data</span><span class="p">,</span> <span class="n">y_tilde</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">MSE of OLS, using the identity matrix as the design matrix: </span><span class="si">{</span><span class="n">mse</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">poly_degs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_poly</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mse_ols_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_poly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mse_ols_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_poly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r2_ols_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_poly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r2_ols_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_poly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta_ols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_poly</span><span class="p">,</span> <span class="n">max_polys</span><span class="p">))</span>

        <span class="n">beta_opt</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="n">min_mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

        <span class="n">t1</span> <span class="o">=</span> <span class="n">perf_counter_ns</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">OLS REGRESSION&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------------&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poly_degs</span><span class="p">)):</span>
            <span class="n">X_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">create_X</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">poly_degs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="n">X_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">create_X</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_test</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">poly_degs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            
            <span class="n">beta</span><span class="p">,</span> <span class="n">y_tilde</span><span class="p">,</span> <span class="n">y_predict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">ord_least_sq</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span>
                                                                   <span class="n">X_test</span><span class="o">=</span><span class="n">X_test</span><span class="p">,</span>
                                                                   <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span>
            
            <span class="n">mse_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">mean_sq_err</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_tilde</span><span class="p">)</span>
            <span class="n">mse_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">mean_sq_err</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_predict</span><span class="p">)</span>
            <span class="n">r2_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">R2_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_tilde</span><span class="p">)</span>
            <span class="n">r2_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">R2_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_predict</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mse_test</span> <span class="o">&lt;</span> <span class="n">min_mse</span><span class="p">:</span>
                <span class="n">beta_opt</span> <span class="o">=</span> <span class="n">beta</span>
                <span class="n">min_mse</span> <span class="o">=</span> <span class="n">mse_test</span>

            <span class="k">if</span> <span class="n">store_beta</span><span class="p">:</span>
                <span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">beta</span>
                <span class="n">zeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_polys</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
                <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">zeros</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">beta_ols</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">beta</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mse_ols_train</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mse_train</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mse_ols_test</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mse_test</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r2_ols_train</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">r2_train</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r2_ols_test</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">r2_test</span>

        <span class="n">t2</span> <span class="o">=</span> <span class="n">perf_counter_ns</span><span class="p">()</span>
        <span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-9</span>

        <span class="k">if</span> <span class="n">time</span><span class="o">%</span><span class="mi">60</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Completed in </span><span class="si">{</span><span class="n">time</span><span class="o">//</span><span class="mi">60</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1"> min </span><span class="si">{</span><span class="n">time</span><span class="o">%</span><span class="mi">60</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1"> sec.&#39;</span><span class="p">)</span>

        <span class="n">min_ols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mse_ols_test</span><span class="p">)</span>
        <span class="n">best_r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r2_ols_test</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">opt_deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_degs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mse_ols_test</span> <span class="o">==</span> <span class="n">min_ols</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">opt_deg_r2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_degs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r2_ols_test</span> <span class="o">==</span> <span class="n">best_r2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">OLS_results</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">OLS results</span><span class="se">\n</span><span class="s1">-----------</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">OLS_results</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;Highest R2 score: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> at degree: </span><span class="si">{</span><span class="n">opt_deg_r2</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">OLS_results</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;Lowest MSE: </span><span class="si">{</span><span class="n">min_ols</span><span class="si">:</span><span class="s1">11.3f</span><span class="si">}</span><span class="s1"> at degree: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_deg</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">OLS_results</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">OLS_results</span> <span class="o">=</span> <span class="n">OLS_results</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_deg</span><span class="p">,</span> <span class="n">beta_opt</span></div>

    
<div class="viewcode-block" id="Regression.ridge_and_lasso">
<a class="viewcode-back" href="../project1.html#src.Regression.ridge_and_lasso">[docs]</a>
    <span class="k">def</span> <span class="nf">ridge_and_lasso</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lambda_min</span><span class="p">,</span> <span class="n">lambda_max</span><span class="p">,</span> <span class="n">poly_deg</span><span class="p">,</span> <span class="n">n_lambda</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Perform Ridge and Lasso regression on the provided data.</span>

<span class="sd">        .. math::</span>
<span class="sd">            \begin{align}</span>
<span class="sd">            \hat\beta&amp;=(X^TX+\lambda\mathbb{I})^{-1}X^T y \\</span>
<span class="sd">            \tilde y&amp;=X\hat\beta</span>
<span class="sd">            \end{align}</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lambda_min, lambda_max : float</span>
<span class="sd">            Lowest/highest value for :math:`\log_{10}\lambda`.</span>
<span class="sd">        </span>
<span class="sd">        poly_deg : int</span>
<span class="sd">            Order of the polynomial to fit. </span>
<span class="sd">        </span>
<span class="sd">        n_lambda : int</span>
<span class="sd">            Number of :math:`\lambda`-elements to compute.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ridge_lasso_poly_deg : int</span>
<span class="sd">            The polynomial degree used for the regression.</span>
<span class="sd">        </span>
<span class="sd">        beta_opt_ridge : ndarray</span>
<span class="sd">            The optimal parameter for the Ridge regression.</span>
<span class="sd">        </span>
<span class="sd">        beta_opt_lasso : ndarray</span>
<span class="sd">            The optimal parameters for the Lasso regression.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ridge_lasso_poly_deg</span> <span class="o">=</span> <span class="n">poly_deg</span>
        <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span>
        <span class="n">X_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">create_X</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                          <span class="n">poly_deg</span><span class="p">)</span>

        <span class="n">X_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">create_X</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_test</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                          <span class="n">poly_deg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lambdas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">lambda_min</span><span class="p">,</span> <span class="n">lambda_max</span><span class="p">,</span> <span class="n">n_lambda</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mse_ridge_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_lambda</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mse_ridge_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_lambda</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r2_ridge_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_lambda</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r2_ridge_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_lambda</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mse_lasso_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_lambda</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mse_lasso_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_lambda</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r2_lasso_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_lambda</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r2_lasso_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_lambda</span><span class="p">)</span>

        <span class="n">beta</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">beta_lasso</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RIDGE AND LASSO REGRESSION&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------------------------&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Finished:&#39;</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">perf_counter_ns</span><span class="p">()</span>
        
        <span class="n">min_mse_lasso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">min_mse_ridge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

        <span class="n">beta_opt_lasso</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="n">beta_opt_ridge</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-2</span> <span class="k">if</span> <span class="n">poly_deg</span> <span class="o">&gt;</span> <span class="mi">6</span> <span class="k">else</span> <span class="mf">1e-4</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_lambda</span><span class="p">):</span>
            <span class="n">lamb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambdas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">beta_ridge</span><span class="p">,</span> <span class="n">y_tilde</span><span class="p">,</span> <span class="n">y_predict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">Ridge</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span>
                                                                  <span class="n">X_test</span><span class="o">=</span><span class="n">X_test</span><span class="p">,</span>
                                                                  <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span>
                                                                  <span class="n">lamb</span><span class="o">=</span><span class="n">lamb</span><span class="p">)</span>

            <span class="n">mse_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">mean_sq_err</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_tilde</span><span class="p">)</span>
            <span class="n">mse_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">mean_sq_err</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_predict</span><span class="p">)</span>
            <span class="n">r2_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">R2_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_tilde</span><span class="p">)</span>
            <span class="n">r2_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">R2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_predict</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mse_ridge_train</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mse_train</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mse_ridge_test</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mse_test</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r2_ridge_train</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">r2_train</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r2_ridge_test</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">r2_test</span>

            <span class="k">if</span> <span class="n">mse_test</span> <span class="o">&lt;</span> <span class="n">min_mse_ridge</span><span class="p">:</span>
                <span class="n">beta_opt_ridge</span> <span class="o">=</span> <span class="n">beta_ridge</span>
                <span class="n">min_mse_ridge</span> <span class="o">=</span> <span class="n">mse_test</span>

            <span class="n">lasso_reg</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">lamb</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e5</span><span class="p">))</span>
            <span class="n">lasso_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

            <span class="n">y_tilde_lasso</span> <span class="o">=</span> <span class="n">lasso_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
            <span class="n">y_predict_lasso</span> <span class="o">=</span> <span class="n">lasso_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

            <span class="n">beta_lasso</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lasso_reg</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>

            <span class="n">mse_train_lasso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">mean_sq_err</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_tilde_lasso</span><span class="p">)</span>
            <span class="n">mse_test_lasso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">mean_sq_err</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_predict_lasso</span><span class="p">)</span>
            <span class="n">r2_train_lasso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">R2_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_tilde_lasso</span><span class="p">)</span>
            <span class="n">r2_test_lasso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">R2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_predict_lasso</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mse_test_lasso</span> <span class="o">&lt;</span> <span class="n">min_mse_lasso</span><span class="p">:</span>
                <span class="n">beta_opt_lasso</span> <span class="o">=</span> <span class="n">lasso_reg</span><span class="o">.</span><span class="n">coef_</span>
                <span class="n">min_mse_lasso</span> <span class="o">=</span> <span class="n">mse_test_lasso</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mse_lasso_train</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mse_train_lasso</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mse_lasso_test</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mse_test_lasso</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r2_lasso_train</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">r2_train_lasso</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r2_lasso_test</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">r2_test_lasso</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n_lambda</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s1">5.1f</span><span class="si">}</span><span class="s1"> %&#39;</span><span class="p">)</span>
        
        <span class="n">t2</span> <span class="o">=</span> <span class="n">perf_counter_ns</span><span class="p">()</span>
        <span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-9</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Completed in </span><span class="si">{</span><span class="n">time</span><span class="o">//</span><span class="mi">60</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1"> min </span><span class="si">{</span><span class="n">time</span><span class="o">%</span><span class="mi">60</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1"> sec.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">beta_ridge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta_lasso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">beta_lasso</span><span class="p">)</span>

        <span class="n">min_ridge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mse_ridge_test</span><span class="p">)</span>
        <span class="n">min_lasso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mse_lasso_test</span><span class="p">)</span>
        <span class="n">abs_diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">min_ridge</span> <span class="o">-</span> <span class="n">min_lasso</span><span class="p">)</span>
        <span class="n">best_r2_ridge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r2_ridge_test</span><span class="p">)</span>
        <span class="n">best_r2_lasso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r2_lasso_test</span><span class="p">)</span>
        
        <span class="n">Ridge_results</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Ridge results</span><span class="se">\n</span><span class="s1">-------------</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">Ridge_results</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;Polynomial degree: </span><span class="si">{</span><span class="n">poly_deg</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">Ridge_results</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;Highest R2 score: </span><span class="si">{</span><span class="n">best_r2_ridge</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1"> at lambda: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lambdas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r2_ridge_test</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">best_r2_ridge</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.3e</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">Ridge_results</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;Lowest MSE: </span><span class="si">{</span><span class="n">min_ridge</span><span class="si">:</span><span class="s1">13.5f</span><span class="si">}</span><span class="s1"> at lambda: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lambdas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mse_ridge_test</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">min_ridge</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.3e</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">Lasso_results</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Lasso results</span><span class="se">\n</span><span class="s1">-------------</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">Lasso_results</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;Polynomial degree: </span><span class="si">{</span><span class="n">poly_deg</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">Lasso_results</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;Highest R2 score: </span><span class="si">{</span><span class="n">best_r2_lasso</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1"> at lambda: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lambdas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r2_lasso_test</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">best_r2_lasso</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.3e</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">Lasso_results</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;Lowest MSE: </span><span class="si">{</span><span class="n">min_lasso</span><span class="si">:</span><span class="s1">13.5f</span><span class="si">}</span><span class="s1"> at lambda: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lambdas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mse_lasso_test</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">min_lasso</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.3e</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">Ridge_results</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Lasso_results</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Absolute difference between Ridge and Lasso MSE: </span><span class="si">{</span><span class="n">abs_diff</span><span class="si">:</span><span class="s1">.3e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ridge_results</span> <span class="o">=</span> <span class="n">Ridge_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Lasso_results</span> <span class="o">=</span> <span class="n">Lasso_results</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ridge_lasso_poly_deg</span><span class="p">,</span> <span class="n">beta_opt_ridge</span><span class="p">,</span> <span class="n">beta_opt_lasso</span></div>


<div class="viewcode-block" id="Regression.plot_evolution">
<a class="viewcode-back" href="../project1.html#src.Regression.plot_evolution">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_evolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">figname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_lasso</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_zoom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale_down</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot the evolution of the Mean Squared Error (MSE), R2 score, and the </span>
<span class="sd">        values for the optimal parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : {&#39;OLS&#39;, &#39;ridge&#39;, &#39;lasso&#39;}</span>
<span class="sd">            Which model to use.</span>

<span class="sd">            * &#39;OLS&#39;: The curves will be as functions of the polynomial degree.</span>
<span class="sd">            * &#39;ridge&#39; or &#39;lasso&#39;: The curves will be as functions of :math:`\lambda`.</span>
<span class="sd">        </span>
<span class="sd">        figname : str</span>
<span class="sd">            For saving the figure.</span>

<span class="sd">        add_lasso : bool, default: True</span>
<span class="sd">            Option to add the `lasso` model to the figure for `ridge`.</span>
<span class="sd">            If so, the figure will show only the MSE and R2 score for </span>
<span class="sd">            both models. </span>
<span class="sd">        </span>
<span class="sd">        add_zoom : bool, default: False</span>
<span class="sd">            If ``True``, the lowest MSE value and highest R2 score will</span>
<span class="sd">            be shown as zoomed in axis.</span>
<span class="sd">        </span>
<span class="sd">        scale_down : bool, default: False</span>
<span class="sd">            The figure may be quite high relative to its width, so the</span>
<span class="sd">            setting this option to ``True`` will scale the height by </span>
<span class="sd">            75 percent.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">=</span> <span class="n">figname</span>

        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;OLS&#39;</span><span class="p">:</span>
            <span class="n">mse_train</span><span class="p">,</span> <span class="n">mse_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse_ols_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse_ols_test</span>
            <span class="n">r2_train</span><span class="p">,</span> <span class="n">r2_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_ols_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_ols_test</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_ols</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_degs</span>
            <span class="n">x_label</span> <span class="o">=</span> <span class="s1">&#39;Polynomial degree&#39;</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;OLS&#39;</span>
        
        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ridge&#39;</span> <span class="ow">and</span> <span class="n">add_lasso</span><span class="p">:</span>
            <span class="n">mse_train</span><span class="p">,</span> <span class="n">mse_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse_ridge_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse_ridge_test</span>
            <span class="n">r2_train</span><span class="p">,</span> <span class="n">r2_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_ridge_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_ridge_test</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_ridge</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambdas</span><span class="p">)</span>

            <span class="n">mse_train_lasso</span><span class="p">,</span> <span class="n">mse_test_lasso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse_lasso_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse_lasso_test</span>
            <span class="n">r2_train_lasso</span><span class="p">,</span> <span class="n">r2_test_lasso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_lasso_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_lasso_test</span>
            <span class="n">beta_lasso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_lasso</span>

            <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="k">if</span> <span class="n">scale_down</span> <span class="k">else</span> <span class="mf">1.0</span>

            <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">\,\lambda$&#39;</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">set_size</span><span class="p">(</span><span class="n">subplot</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span><span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Polynomial degree: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ridge_lasso_poly_deg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mse_test</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ridge test&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mse_train</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ridge train&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mse_test_lasso</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lasso test&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mse_train_lasso</span><span class="p">,</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lasso train&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;MSE&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r2_test</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ridge test&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r2_train</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ridge train&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r2_test_lasso</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lasso test&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r2_train_lasso</span><span class="p">,</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lasso train&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;R2 score&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">)</span>

            <span class="n">has_min_mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mse_test</span> <span class="o">&lt;</span> <span class="n">mse_test</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">has_min_mse_lasso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mse_test_lasso</span> <span class="o">&lt;</span> <span class="n">mse_test_lasso</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">has_max_r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">r2_test</span> <span class="o">&gt;</span> <span class="n">r2_test</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">has_max_r2_lasso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">r2_test_lasso</span> <span class="o">&gt;</span> <span class="n">r2_test_lasso</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">mse_cond</span> <span class="o">=</span> <span class="p">[</span><span class="n">has_min_mse</span><span class="p">,</span> <span class="n">has_min_mse_lasso</span><span class="p">]</span>
            <span class="n">r2_cond</span> <span class="o">=</span> <span class="p">[</span><span class="n">has_max_r2</span><span class="p">,</span> <span class="n">has_max_r2_lasso</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">add_zoom</span><span class="p">:</span>
                <span class="n">x_diff</span> <span class="o">=</span> <span class="mf">0.5</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mse_cond</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mse_test_lasso</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mse_test</span><span class="p">):</span>
                        <span class="n">y_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mse_test_lasso</span><span class="p">)</span>
                        <span class="n">best_model</span> <span class="o">=</span> <span class="n">mse_test_lasso</span>
                    
                    <span class="k">else</span><span class="p">:</span> 
                        <span class="n">y_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mse_test</span><span class="p">)</span>
                        <span class="n">best_model</span> <span class="o">=</span> <span class="n">mse_test</span>

                    <span class="n">x_center_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">best_model</span> <span class="o">==</span> <span class="n">y_center</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">x_center</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">x_center_idx</span><span class="p">]</span>

                    <span class="n">y_diff</span> <span class="o">=</span> <span class="mf">0.00005</span>

                    <span class="n">x01</span> <span class="o">=</span> <span class="n">x_center</span> <span class="o">-</span> <span class="n">x_diff</span>
                    <span class="n">x02</span> <span class="o">=</span> <span class="n">x_center</span> <span class="o">+</span> <span class="n">x_diff</span>
                    <span class="n">y01</span> <span class="o">=</span> <span class="n">y_center</span> <span class="o">-</span> <span class="n">y_diff</span>
                    <span class="n">y02</span> <span class="o">=</span> <span class="n">y_center</span> <span class="o">+</span> <span class="n">y_diff</span>

                    <span class="n">axins0</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">(</span>
                        <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
                        <span class="c1"># [x[0], 0.055, 4.5, 0.02],</span>
                        <span class="c1"># transform=ax[0].transData,</span>
                        <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">x01</span><span class="p">,</span> <span class="n">x02</span><span class="p">),</span>
                        <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="n">y01</span><span class="p">,</span> <span class="n">y02</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="n">axins0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mse_test</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                    <span class="n">axins0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mse_test_lasso</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">corners</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indicate_inset_zoom</span><span class="p">(</span><span class="n">axins0</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">corners</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">corners</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">corners</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">corners</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">r2_cond</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">r2_test_lasso</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">r2_test</span><span class="p">):</span>
                        <span class="n">y_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">r2_test_lasso</span><span class="p">)</span>
                        <span class="n">best_model</span> <span class="o">=</span> <span class="n">r2_test_lasso</span>
                    
                    <span class="k">else</span><span class="p">:</span> 
                        <span class="n">y_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">r2_test</span><span class="p">)</span>
                        <span class="n">best_model</span> <span class="o">=</span> <span class="n">r2_test</span>

                    <span class="n">x_center_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">best_model</span> <span class="o">==</span> <span class="n">y_center</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">x_center</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">x_center_idx</span><span class="p">]</span>

                    <span class="n">y_diff</span> <span class="o">=</span> <span class="mf">0.0005</span>

                    <span class="n">x11</span> <span class="o">=</span> <span class="n">x_center</span> <span class="o">-</span> <span class="n">x_diff</span>
                    <span class="n">x12</span> <span class="o">=</span> <span class="n">x_center</span> <span class="o">+</span> <span class="n">x_diff</span>
                    <span class="n">y11</span> <span class="o">=</span> <span class="n">y_center</span> <span class="o">-</span> <span class="n">y_diff</span>
                    <span class="n">y12</span> <span class="o">=</span> <span class="n">y_center</span> <span class="o">+</span> <span class="n">y_diff</span>

                    <span class="n">axins1</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">(</span>
                        <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
                        <span class="c1"># [x[0], 0.32, 4.5, 0.175],</span>
                        <span class="c1"># transform=ax[1].transData,</span>
                        <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">x11</span><span class="p">,</span> <span class="n">x12</span><span class="p">),</span>
                        <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="n">y11</span><span class="p">,</span> <span class="n">y12</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="n">axins1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r2_test</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                    <span class="n">axins1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r2_test_lasso</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">corners1</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">indicate_inset_zoom</span><span class="p">(</span><span class="n">axins1</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">corners1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">corners1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">corners1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">corners1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">mse_cond</span><span class="p">,</span> <span class="n">r2_cond</span><span class="p">]):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Requested zoom but the best score is the first value.&#39;</span><span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/&#39;</span> <span class="o">+</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;_lasso_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/&#39;</span> <span class="o">+</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;_lasso_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>

            <span class="k">return</span>
        
        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ridge&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">add_lasso</span><span class="p">:</span>
            <span class="n">mse_train</span><span class="p">,</span> <span class="n">mse_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse_ridge_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse_ridge_test</span>
            <span class="n">r2_train</span><span class="p">,</span> <span class="n">r2_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_ridge_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_ridge_test</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_ridge</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambdas</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Ridge, polynomial degree: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ridge_lasso_poly_deg</span><span class="si">}</span><span class="s1">&#39;</span>

            <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">\,\lambda$&#39;</span>
        
        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;lasso&#39;</span><span class="p">:</span>
            <span class="n">mse_train</span><span class="p">,</span> <span class="n">mse_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse_lasso_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse_lasso_test</span>
            <span class="n">r2_train</span><span class="p">,</span> <span class="n">r2_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_lasso_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_lasso_test</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_lasso</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambdas</span><span class="p">)</span>
            <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">\,\lambda$&#39;</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Lasso, polynomial degree: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ridge_lasso_poly_deg</span><span class="si">}</span><span class="s1">&#39;</span>
        
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;OLS&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_beta</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">set_size</span><span class="p">(</span><span class="n">subplot</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mse_test</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mse_train</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;MSE&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r2_test</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r2_train</span><span class="p">,</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;R2 Score&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/&#39;</span> <span class="o">+</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/&#39;</span> <span class="o">+</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">grid_spec</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">set_size</span><span class="p">(</span> <span class="n">subplot</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.75</span><span class="p">),</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="n">grid_spec</span><span class="p">)</span>

            <span class="n">line1</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mse_test</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">)</span>
            <span class="n">line2</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mse_train</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;MSE&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r2_test</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r2_train</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;R2 score&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;OLS&#39;</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">beta</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])):</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\beta$&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;$_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">$&#39;</span>
                    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="ow">not</span> <span class="n">figname</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span> <span class="ow">and</span> <span class="n">beta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span><span class="s1">&#39;ridge&#39;</span> <span class="ow">or</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;lasso&#39;</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])):</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\beta$&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;$_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">$&#39;</span>
                    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\beta_i$ value&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">],</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.81</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/&#39;</span> <span class="o">+</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/&#39;</span> <span class="o">+</span> <span class="n">model</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Regression.bias_variance_tradeoff">
<a class="viewcode-back" href="../project1.html#src.Regression.bias_variance_tradeoff">[docs]</a>
    <span class="k">def</span> <span class="nf">bias_variance_tradeoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_degree</span><span class="p">,</span> <span class="n">n_bootstraps</span><span class="p">,</span> <span class="n">data_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">best_deg_ols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compute OLS with a user defined number of bootstraps on the data</span>
<span class="sd">        and plot the evolution of the bias and variance as functions of</span>
<span class="sd">        the polynomial degree.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        max_degree : int</span>
<span class="sd">            Maximum polynomial degree to evalute the OLS for.</span>
<span class="sd">        </span>
<span class="sd">        n_bootstraps : int </span>
<span class="sd">            The number of bootstrap resamples to perform.</span>
<span class="sd">        </span>
<span class="sd">        data_dim : int, default: 2</span>
<span class="sd">            Dimension of the data the model is evaluated on.</span>
<span class="sd">        </span>
<span class="sd">        beta_deg_ols : int or float, optional</span>
<span class="sd">            The optimal degree as computed by the :any:`OLS` method.</span>
<span class="sd">            If not given, the degree is assumed to be computed from </span>
<span class="sd">            the same code run as the present one.</span>
<span class="sd">        </span>
<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        As the data traffic can be very large, the number of samples </span>
<span class="sd">        used to perform the regression should not be too big, as this </span>
<span class="sd">        can lead to the program being killed before completing. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span>
        
        <span class="n">ols_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_deg</span> <span class="k">if</span> <span class="n">best_deg_ols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">best_deg_ols</span>

        <span class="k">if</span> <span class="n">data_dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">max_degree</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">max_degree</span><span class="p">)</span>
            <span class="n">error_y_test</span> <span class="o">=</span> <span class="n">y_test</span>
            <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;test-bias-var-trade&#39;</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
        
        <span class="k">elif</span> <span class="n">data_dim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">==</span> <span class="s1">&#39;geodata&#39;</span><span class="p">:</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_degree</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">error_y_test</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">+</span> <span class="s1">&#39;-bias-var-trade&#39;</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_degree</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">error_y_test</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">False</span> 
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">+</span> <span class="s1">&#39;-bias-var-trade&#39;</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
        
        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_degree</span><span class="p">)</span>
        <span class="n">bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

        <span class="n">bias_var_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">tradeoff</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">BIAS VARIANCE TRADEOFF&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Finished:&#39;</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">perf_counter_ns</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">deg</span> <span class="ow">in</span> <span class="n">degree</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="n">deg</span><span class="p">),</span>
                                  <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

            <span class="n">idx</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">==</span> <span class="s1">&#39;geodata&#39;</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">idx</span><span class="p">,</span> <span class="n">n_bootstraps</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bootstraps</span><span class="p">):</span>
                <span class="n">x_</span><span class="p">,</span> <span class="n">y_</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
                <span class="n">y_pred</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="n">error</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">error_y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">))</span>
            <span class="n">bias</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">variance</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">))</span>

            <span class="n">dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">bias</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">variance</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>

            <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">bias_var_dist</span><span class="p">:</span>
                <span class="n">tradeoff</span> <span class="o">=</span> <span class="n">deg</span> 
                <span class="n">bias_var_dist</span> <span class="o">=</span> <span class="n">dist</span>

            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">deg</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">max_degree</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s1">5.1f</span><span class="si">}</span><span class="s1"> %&#39;</span><span class="p">)</span>

        <span class="n">t2</span> <span class="o">=</span> <span class="n">perf_counter_ns</span><span class="p">()</span>
        <span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-9</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Completed in </span><span class="si">{</span><span class="n">time</span><span class="o">//</span><span class="mi">60</span><span class="si">}</span><span class="s1"> min </span><span class="si">{</span><span class="n">time</span><span class="o">%</span><span class="mi">60</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1"> sec.&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Trade-off happens at degree: </span><span class="si">{</span><span class="n">tradeoff</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tradeoff</span> <span class="o">=</span> <span class="n">tradeoff</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">set_size</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_bootstraps</span><span class="si">}</span><span class="s1"> bootstraps&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">bias</span><span class="p">,</span> <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bias&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Variance&#39;</span><span class="p">)</span>

        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">tradeoff</span><span class="p">,</span> <span class="n">tradeoff</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashdot&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trade-off&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ols_p</span><span class="p">,</span> <span class="n">ols_p</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;OLS&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Polynomial degree&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">degree</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))[::</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/&#39;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/&#39;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Regression.cross_validation">
<a class="viewcode-back" href="../project1.html#src.Regression.cross_validation">[docs]</a>
    <span class="k">def</span> <span class="nf">cross_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_kfolds</span><span class="p">,</span> <span class="n">best_deg_ols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tradeoff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_zoom</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate and plot the results from a k-fold cross validation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_kfolds : int </span>
<span class="sd">            The number of k-folds to concider.</span>
<span class="sd">        </span>
<span class="sd">        best_deg_ols : int or float, optional</span>
<span class="sd">            See :any:`bias_variance_tradeoff`</span>
<span class="sd">        </span>
<span class="sd">        tradeoff : int or float, optional</span>
<span class="sd">            The degree where the bias-variance trade-off happens. If </span>
<span class="sd">            not set, the method assumes the degree has been computed </span>
<span class="sd">            during the present run.</span>
<span class="sd">        </span>
<span class="sd">        add_zoom : bool, default: False</span>
<span class="sd">            If ``True`` , a zoomed in axis will display the location</span>
<span class="sd">            where the best model, i.e. eihter Lasso or Ridge has its </span>
<span class="sd">            lowest MSE. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_data</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="n">ols_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_deg</span> <span class="k">if</span> <span class="n">best_deg_ols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">best_deg_ols</span>
        <span class="n">trade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tradeoff</span> <span class="k">if</span> <span class="n">tradeoff</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">tradeoff</span>
        
        <span class="n">n_data</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_data</span><span class="p">)</span>
        <span class="n">shuffled_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_data</span><span class="p">)</span>
        <span class="n">kfolds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">shuffled_inds</span><span class="p">,</span> <span class="n">n_kfolds</span><span class="p">)</span>
        <span class="n">KFold_sklearn</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">n_kfolds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2023</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">==</span> <span class="s1">&#39;geodata&#39;</span><span class="p">:</span>
            <span class="n">n_poly</span> <span class="o">=</span> <span class="mi">21</span>
            <span class="n">n_lambda</span> <span class="o">=</span> <span class="mi">75</span>
            <span class="n">lambdas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">n_lambda</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_poly</span> <span class="o">=</span> <span class="mi">16</span>
            <span class="n">n_lambda</span> <span class="o">=</span> <span class="mi">75</span>
            <span class="n">lambdas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">n_lambda</span><span class="p">)</span>

        <span class="n">poly_deg</span> <span class="o">=</span> <span class="n">tradeoff</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_poly</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">scores_OLS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_poly</span><span class="p">,</span> <span class="n">n_kfolds</span><span class="p">))</span>
        <span class="n">scores_Ridge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_lambda</span><span class="p">,</span> <span class="n">n_kfolds</span><span class="p">))</span>
        <span class="n">scores_Lasso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">scores_Ridge</span><span class="p">)</span>

        <span class="n">est_MSE_OLS_sklearn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_poly</span><span class="p">)</span>
        <span class="n">est_MSE_Ridge_sklearn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_lambda</span><span class="p">)</span>
        <span class="n">est_MSE_Lasso_sklearn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">est_MSE_Ridge_sklearn</span><span class="p">)</span>

        <span class="nd">@njit</span>
        <span class="k">def</span> <span class="nf">_compute_OLS</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
<span class="w">            </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Helper function to compute the OLS with the no-python </span>
<span class="sd">            decorator.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            X_train : ndarray</span>
<span class="sd">                Training part of the design matrix.</span>
<span class="sd">            </span>
<span class="sd">            X_test : ndarray</span>
<span class="sd">                Testing part of the design matrix.</span>
<span class="sd">            </span>
<span class="sd">            y_train : ndarray</span>
<span class="sd">                Train data.</span>

<span class="sd">            y_test : ndarray</span>
<span class="sd">                Test data.</span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            float :</span>
<span class="sd">                The MSE.</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X_train</span><span class="p">)</span> <span class="o">@</span> <span class="n">X_train</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">y_train</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">X_test</span> <span class="o">@</span> <span class="n">beta</span>

            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">size</span>
        
        <span class="nd">@njit</span>
        <span class="k">def</span> <span class="nf">_compute_Ridge</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">lamb</span><span class="p">):</span>
<span class="w">            </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Helper function to compute the Ridge with the no-python </span>
<span class="sd">            decorator.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            X_train : ndarray</span>
<span class="sd">                Training part of the design matrix.</span>
<span class="sd">            </span>
<span class="sd">            X_test : ndarray</span>
<span class="sd">                Testing part of the design matrix.</span>
<span class="sd">            </span>
<span class="sd">            y_train : ndarray</span>
<span class="sd">                Train data.</span>

<span class="sd">            y_test : ndarray</span>
<span class="sd">                Test data.</span>
<span class="sd">            </span>
<span class="sd">            lamb : float</span>
<span class="sd">                The regularization parameter.</span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            float :</span>
<span class="sd">                The MSE.</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">_singular</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X_train</span> <span class="o">+</span> <span class="n">lamb</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">U</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">VT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">_singular</span><span class="p">)</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">U</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">VT</span><span class="p">)))</span>
            <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="n">_unsingular</span> <span class="o">=</span> <span class="n">U</span> <span class="o">@</span> <span class="n">D</span> <span class="o">@</span> <span class="n">VT</span> 
            <span class="n">inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">_unsingular</span><span class="p">)</span>

            <span class="n">beta</span> <span class="o">=</span> <span class="n">inv</span> <span class="o">@</span> <span class="n">X_train</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">y_train</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">X_test</span> <span class="o">@</span> <span class="n">beta</span>

            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">size</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">CROSS VALIDATION&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Finished:&#39;</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">perf_counter_ns</span><span class="p">()</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="k">if</span> <span class="n">poly_deg</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="k">else</span> <span class="mf">1e-4</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_kfolds</span><span class="p">):</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="n">kfolds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">boolean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
            <span class="n">boolean</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> 
            <span class="n">train_inds</span> <span class="o">=</span> <span class="o">~</span><span class="n">boolean</span> 
            <span class="n">test_inds</span> <span class="o">=</span> <span class="n">boolean</span>

            <span class="n">x_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">train_inds</span><span class="p">]</span>
            <span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_inds</span><span class="p">]</span>
            <span class="n">x_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">test_inds</span><span class="p">]</span>
            <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">test_inds</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">deg</span> <span class="ow">in</span> <span class="n">degrees</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">deg</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="n">X_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">create_X</span><span class="p">(</span><span class="n">x_train</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">deg</span><span class="p">)</span>
                <span class="n">X_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">create_X</span><span class="p">(</span><span class="n">x_test</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x_test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">deg</span><span class="p">)</span>

                <span class="c1"># OLS</span>
                <span class="n">scores_OLS</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_compute_OLS</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

                <span class="c1"># Sklearn&#39;s OLS results</span>
                <span class="n">X_sklearn</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="n">deg</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
                <span class="n">lin</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">MSE_OLS_sklearn</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">lin</span><span class="p">,</span> <span class="n">X_sklearn</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">KFold_sklearn</span><span class="p">)</span>
                <span class="n">est_MSE_OLS_sklearn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="o">-</span><span class="n">MSE_OLS_sklearn</span><span class="p">)</span>

            <span class="c1"># Ridge and Lasso</span>
            <span class="n">poly</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="n">poly_deg</span><span class="p">)</span>
            <span class="n">X_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">create_X</span><span class="p">(</span><span class="n">x_train</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">poly_deg</span><span class="p">)</span>
            <span class="n">X_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">create_X</span><span class="p">(</span><span class="n">x_test</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x_test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">poly_deg</span><span class="p">)</span>
            <span class="n">X_sklearn</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">lamb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lambdas</span><span class="p">):</span>
                <span class="n">scores_Ridge</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_compute_Ridge</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">lamb</span><span class="p">)</span>

                <span class="c1"># Sklearn&#39;s Ridge results</span>
                <span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">lamb</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">MSE_Ridge_sklearn</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">ridge</span><span class="p">,</span> <span class="n">X_sklearn</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">KFold_sklearn</span><span class="p">)</span>
                <span class="n">est_MSE_Ridge_sklearn</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="o">-</span><span class="n">MSE_Ridge_sklearn</span><span class="p">)</span>

                <span class="c1"># Sklearn&#39; Lasso results</span>
                <span class="n">lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">lamb</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e5</span><span class="p">))</span>
                <span class="n">y_pred_Lasso</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
                <span class="n">scores_Lasso</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_pred_Lasso</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y_pred_Lasso</span><span class="p">)</span>
                <span class="n">MSE_Lasso_sklearn</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">lasso</span><span class="p">,</span> <span class="n">X_sklearn</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">KFold_sklearn</span><span class="p">)</span>
                <span class="n">est_MSE_Lasso_sklearn</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="o">-</span><span class="n">MSE_Lasso_sklearn</span><span class="p">)</span>
            
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="p">(</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lambdas</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_kfolds</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s1">5.1f</span><span class="si">}</span><span class="s1"> %&#39;</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">t2</span> <span class="o">=</span> <span class="n">perf_counter_ns</span><span class="p">()</span>
        <span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-9</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Completed in </span><span class="si">{</span><span class="n">time</span><span class="o">//</span><span class="mi">60</span><span class="si">}</span><span class="s1"> min </span><span class="si">{</span><span class="n">time</span><span class="o">%</span><span class="mi">60</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1"> sec.&#39;</span><span class="p">)</span>
        
        <span class="n">est_MSE_OLS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores_OLS</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">est_MSE_Ridge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores_Ridge</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">est_MSE_Lasso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores_Lasso</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">best_MSE_OLS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">est_MSE_OLS</span><span class="p">)</span>
        <span class="n">best_MSE_Ridge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">est_MSE_Ridge</span><span class="p">)</span>
        <span class="n">best_MSE_Lasso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">est_MSE_Lasso</span><span class="p">)</span>
        <span class="n">best_deg</span> <span class="o">=</span> <span class="n">degrees</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">est_MSE_OLS</span> <span class="o">==</span> <span class="n">best_MSE_OLS</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">best_lamb_Ridge</span> <span class="o">=</span> <span class="n">lambdas</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">est_MSE_Ridge</span> <span class="o">==</span> <span class="n">best_MSE_Ridge</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">best_lamb_Lasso</span> <span class="o">=</span> <span class="n">lambdas</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">est_MSE_Lasso</span> <span class="o">==</span> <span class="n">best_MSE_Lasso</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;OLS:</span><span class="si">{</span><span class="n">best_MSE_OLS</span><span class="si">:</span><span class="s1">10.3f</span><span class="si">}</span><span class="s1"> at degree </span><span class="si">{</span><span class="n">best_deg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ridge:</span><span class="si">{</span><span class="n">best_MSE_Ridge</span><span class="si">:</span><span class="s1">8.3f</span><span class="si">}</span><span class="s1"> at lambda </span><span class="si">{</span><span class="n">best_lamb_Ridge</span><span class="si">:</span><span class="s1">.3g</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lasso:</span><span class="si">{</span><span class="n">best_MSE_Lasso</span><span class="si">:</span><span class="s1">8.3f</span><span class="si">}</span><span class="s1"> at lambda </span><span class="si">{</span><span class="n">best_lamb_Lasso</span><span class="si">:</span><span class="s1">.3g</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">set_size</span><span class="p">(</span><span class="n">subplot</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n_kfolds</span><span class="si">}</span><span class="s1"> KFolds&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">degrees</span><span class="p">,</span> <span class="n">est_MSE_OLS</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;OLS&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">degrees</span><span class="p">,</span> <span class="n">est_MSE_OLS_sklearn</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Polynomial degree&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">)</span>

        <span class="n">lasso</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lambdas</span><span class="p">),</span> <span class="n">est_MSE_Lasso</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Lasso&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lambdas</span><span class="p">),</span> <span class="n">est_MSE_Lasso_sklearn</span><span class="p">,</span> <span class="s1">&#39;b--&#39;</span><span class="p">)</span>
        <span class="n">ridge</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lambdas</span><span class="p">),</span> <span class="n">est_MSE_Ridge</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Ridge&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lambdas</span><span class="p">),</span> <span class="n">est_MSE_Ridge_sklearn</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">\lambda$&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">best_MSE_Ridge</span> <span class="o">&lt;</span> <span class="n">best_MSE_Lasso</span><span class="p">:</span>
            <span class="n">y_center</span> <span class="o">=</span> <span class="n">best_MSE_Ridge</span>
            <span class="n">best_model</span> <span class="o">=</span> <span class="n">est_MSE_Ridge</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ridge</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_center</span> <span class="o">=</span> <span class="n">best_MSE_Lasso</span>
            <span class="n">best_model</span> <span class="o">=</span> <span class="n">est_MSE_Lasso</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">lasso</span>

        <span class="n">x_center_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">best_model</span> <span class="o">==</span> <span class="n">y_center</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lambdas</span><span class="p">[</span><span class="n">x_center_idx</span><span class="p">])</span>
        <span class="n">y_diff</span> <span class="o">=</span> <span class="mf">2e-4</span>

        <span class="n">x1</span> <span class="o">=</span> <span class="n">x_center</span> <span class="o">-</span> <span class="mf">0.7</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x_center</span> <span class="o">+</span> <span class="mf">0.7</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y_center</span> <span class="o">-</span> <span class="n">y_diff</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">y_center</span> <span class="o">+</span> <span class="n">y_diff</span>

        <span class="n">axins</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">(</span>
                        <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
                        <span class="c1"># [x[0], 0.055, 4.5, 0.02],</span>
                        <span class="c1"># transform=ax2.transData,</span>
                        <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span>
                        <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">axins</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lambdas</span><span class="p">),</span> <span class="n">best_model</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lambdas</span><span class="p">),</span> <span class="n">est_MSE_Lasso_sklearn</span><span class="p">,</span> <span class="s1">&#39;b--&#39;</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lambdas</span><span class="p">),</span> <span class="n">est_MSE_Ridge_sklearn</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">corners</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">indicate_inset_zoom</span><span class="p">(</span><span class="n">axins</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">corners</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">corners</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">corners</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">corners</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


        <span class="n">fig</span><span class="o">.</span><span class="n">supylabel</span><span class="p">(</span><span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;-</span><span class="si">{</span><span class="n">n_kfolds</span><span class="si">}</span><span class="s1">-KFolds-cross-val.png&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">figname</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;-</span><span class="si">{</span><span class="n">n_kfolds</span><span class="si">}</span><span class="s1">-KFolds-cross-val.pdf&#39;</span><span class="p">)</span></div>
</div>

        
<div class="viewcode-block" id="frankes_function">
<a class="viewcode-back" href="../project1.html#src.frankes_function">[docs]</a>
<span class="k">def</span> <span class="nf">frankes_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">add_noise</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Franke&#39;s function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x, y : array_like</span>
<span class="sd">        The `x` and `y` values to evaluate the function on.</span>

<span class="sd">    add_noise : bool, default: True</span>
<span class="sd">        Weather to add Gaussian noise :math:`\epsilon\sim\mathcal N(+,\sigma^2)`</span>
<span class="sd">        to the data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    array_like</span>
<span class="sd">        The resulting Franke&#39;s function, with or without the noise. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">term1</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">((</span><span class="mi">9</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="mi">9</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">49.0</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">term3</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">7</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">4.0</span> <span class="o">-</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">((</span><span class="mi">9</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">term4</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">7</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span> <span class="o">+</span> <span class="n">term3</span> <span class="o">+</span> <span class="n">term4</span>

    <span class="k">if</span> <span class="n">add_noise</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">res</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">res</span></div>

    
<div class="viewcode-block" id="compare_surface">
<a class="viewcode-back" href="../project1.html#src.compare_surface">[docs]</a>
<span class="k">def</span> <span class="nf">compare_surface</span><span class="p">(</span><span class="n">linspace</span><span class="p">,</span> <span class="n">poly_deg</span><span class="p">,</span> <span class="n">surface</span><span class="p">,</span> <span class="n">reg_model</span><span class="p">,</span> <span class="n">azim_view_init</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create a side-by-side comparison figure of model and surface data.</span>

<span class="sd">    The figure will display both the maps and the surfaces.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    linspace : ndarray</span>
<span class="sd">        A ``np.linspace`` instance that will be used to create the mesh</span>
<span class="sd">        grid.</span>
<span class="sd">    </span>
<span class="sd">    poly_deg : int</span>
<span class="sd">        Polynomial degree to use for the regression.</span>
<span class="sd">    </span>
<span class="sd">    surface : array_like</span>
<span class="sd">        The true surface.</span>
<span class="sd">    </span>
<span class="sd">    reg_model : {&#39;OLS&#39;, &#39;Ridge&#39;}, str</span>
<span class="sd">        Regression model to be used. Available are OLS and Ridge.</span>
<span class="sd">    </span>
<span class="sd">   azim_view_init : int, default: 45</span>
<span class="sd">        The azimuthal angle to view the 3D surface from. </span>
<span class="sd">    </span>
<span class="sd">    cmap : str, default: &#39;terrain&#39;</span>
<span class="sd">        Colormap to use when plotting.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mods</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;OLS&#39;</span><span class="p">:</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">ord_least_sq</span><span class="p">,</span>
            <span class="s1">&#39;Ridge&#39;</span><span class="p">:</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">Ridge</span>
           <span class="p">}</span>

    <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;figures/&#39;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reg_model</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">figname</span><span class="p">,</span> <span class="n">modname</span> <span class="o">=</span> <span class="n">reg_model</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">modname</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">mods</span><span class="p">[</span><span class="n">modname</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">+=</span> <span class="n">figname</span>
    
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">name</span> <span class="o">=</span> <span class="n">reg_model</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">mods</span><span class="p">[</span><span class="n">reg_model</span><span class="p">]</span>

    <span class="n">name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;-compare-terrain-</span><span class="si">{</span><span class="n">poly_deg</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">path</span> <span class="o">+=</span> <span class="n">name</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">linspace</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span> 
    <span class="n">y</span> <span class="o">=</span> <span class="n">linspace</span> 
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="n">feature</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">create_X</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">poly_deg</span><span class="p">)</span>
    <span class="n">beta</span><span class="p">,</span> <span class="n">ytilde</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mod</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">surface</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">ytilde</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">set_size</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">subplot</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.65</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">ytilde</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">antialiased</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span>
    <span class="p">)</span>

    <span class="n">ax3</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="n">azim_view_init</span><span class="p">)</span>

    <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">surface</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">antialiased</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ax4</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="n">azim_view_init</span><span class="p">)</span>

    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">reg_model</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;, polynomial degree </span><span class="si">{</span><span class="n">poly_deg</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">im1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ytilde</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">im2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">ims</span> <span class="o">=</span> <span class="p">[</span><span class="n">im1</span><span class="p">,</span> <span class="n">im2</span><span class="p">]</span>

    <span class="n">label1</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">label2</span> <span class="o">=</span> <span class="s1">&#39;Elevation [km]&#39;</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">label1</span><span class="p">,</span> <span class="n">label2</span><span class="p">]</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Model&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y$&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y$&#39;</span><span class="p">)</span>    
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$z$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Terrain data&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y$&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y$&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$z$&#39;</span><span class="p">)</span>

    <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">]</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Normalized elevation&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Normalized elevation&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Johan Carlsen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>